pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
function _init()
  p = {
    x = 0,
    y = 6,
    dx = 0,
    dy = 0,
    dir = 1, -- left:0 right:1 up:2 down:3
    next_dir = 1,
    v = 0.30,
    points = 0,
  }
  t = 0
end

function _update()
  if btnp(0) then p.next_dir = 0 end
  if btnp(1) then p.next_dir = 1 end
  if btnp(2) then p.next_dir = 2 end
  if btnp(3) then p.next_dir = 3 end

  player_movement()
  check_points()

  t += 1
end

function _draw()
  cls()
  map()
  draw_player()
end

function player_movement()
  local next_cell_x = p.x
  local next_cell_y = p.y

  if p.dir == 0 then next_cell_x -= 1 end
  if p.dir == 1 then next_cell_x += 1 end
  if p.dir == 2 then next_cell_y -= 1 end
  if p.dir == 3 then next_cell_y += 1 end

  if mget(next_cell_x, next_cell_y) ~= 1 then
    if p.dir == 0 then p.dx -= p.v end
    if p.dir == 1 then p.dx += p.v end
    if p.dir == 2 then p.dy -= p.v end
    if p.dir == 3 then p.dy += p.v end
  end

  if p.dx > 8 then
    p.x = (p.x+1)%16
    p.dx = 0
  end
  if p.dx < -8 then
    p.x = (p.x-1)%16
    p.dx = 0
  end
  if p.dy > 8 then
    p.y = (p.y+1)%16
    p.dy = 0
  end
  if p.dy < -8 then
    p.y = (p.y-1)%16
    p.dy = 0
  end

  if p.next_dir ~= p.dir and p.dx == 0 and p.dy == 0 then
    local next_cell_x = p.x
    local next_cell_y = p.y

    if p.next_dir == 0 then next_cell_x -= 1 end
    if p.next_dir == 1 then next_cell_x += 1 end
    if p.next_dir == 2 then next_cell_y -= 1 end
    if p.next_dir == 3 then next_cell_y += 1 end

    if mget(next_cell_x, next_cell_y) ~= 1 then
      p.dir = p.next_dir
    end
  end
end

function check_points()
  local cell = mget(p.x, p.y)
  local point = 0

  if cell == 2 then
    point = 1
  elseif cell == 3 then
    point = 10
  end

  if point > 0 then
    p.points += point
    p.v += 0.01
    mset(p.x, p.y, 0)
  end
end

function draw_player()
  local sprite = 16
  if p.dir == 2 or p.dir == 3 then
    sprite = 18
  end
  local x = p.x * 8 + p.dx
  local y = p.y * 8 + p.dy
  local flip_x = p.dir == 0
  local flip_y = p.dir == 3

  print(p.x..' '..p.y..' points: '..p.points)
  spr(sprite + (t/8%2), x, y, 1, 1, flip_x, flip_y)
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700011001100000000000099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000009900000999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000009900000999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700011001100000000000099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00aaaa0000aaa00000a00a00000aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0aaa00000aaaaa000aa00aa000aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0aaa00000aaaaa000aaaaaa000aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00aaaa0000aaa00000aaaa0000aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000aa00000000000000aa000000aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0103020202020201010202020202030100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010101010202020201010101020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020202010201010201020202020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010102020202020202020101020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010102010101010101020101020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002020202010302020301020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010102020201010202020101020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010101010201010201010101020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010201010201010201010201020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010201010202020201010201020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010302010201010201020301020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010102010202020201020101020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0103020202020201010202020202030100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
